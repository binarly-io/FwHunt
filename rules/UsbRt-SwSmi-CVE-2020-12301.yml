UsbRt-SwSmi-CVE-2020-12301:
  meta:
    author:       Binarly
    license:      CC0-1.0
    name:         UsbRt-SwSmi-CVE-2020-12301
    version:      1.0
    namespace:    vulnerabilities
    CVE number:   CVE-2020-12301
    vendor id:    INTEL-SA-00367
    CVSS score:   7.5 High
    advisory:     https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00367.html
    description:  Detection for SMM callout in SW SMI handler on multiple Intel server platforms
  guids:
    - 0:
      - name: EFI_SMM_USB_DISPATCH2_PROTOCOL_GUID
      - value: EE9B8D90-C5A6-40A2-BDE252558D33CCA1
    - 1:
      - name: EFI_SMM_SW_DISPATCH2_PROTOCOL_GUID
      - value: 18A3C6DC-5EEA-48C8-A1C1B53389F98999
  hex_strings:
    0: fec3413a98f8670000
        # Detect part of the following code:
        # for ( i = 0; i < *(UsbData + 0x67F8); ++i )
        # fec3                                inc     bl
        # 413a98f8670000                      cmp     bl, [r8+67F8h]
    1: 498b80f06700000fb6d3488b0cd04885c9
        # Detect part of the following code:
        # Ptr = *(UsbData + 0x67F0);
        # Table = *(Ptr + 8i64 * i);
        # 498b80f0670000                      mov     rax, [r8+67F0h]
        # 0fb6d3                              movzx   edx, bl
        # 488b0cd0                            mov     rcx, [rax+rdx*8]
        # 4885c9                              test    rcx, rcx
    2: 0fb6410183e8104863d048c1fa044869c2b800000042ff940080000000
        # Detect part of the following code:
        # Ptr = (*(0xB8 * ((*(Table + 1) - 16) >> 4) + UsbData + 0x80))();
        # 0fb64101                            movzx   eax, byte ptr [rcx+1]
        # 83e810                              sub     eax, 10h
        # 4863d0                              movsxd  rdx, eax
        # 48c1fa04                            sar     rdx, 4
        # 4869c2b8000000                      imul    rax, rdx, 0B8h ; 'Â¸'
        # 42ff940080000000                    call    qword ptr [rax+r8+80h]
